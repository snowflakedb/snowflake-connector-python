#
# Copyright (c) 2012-2023 Snowflake Computing Inc. All rights reserved.
#

from test_utils import read_file_to_float_list


def mean(l):
    return sum(l) / len(l)


prefix = "/tmp/aiohttp_test/connect with OCSP cache (500 calls)/"
print(prefix)
print("~~~~~~~~~~~~~~~~")
f = read_file_to_float_list(f"{prefix}overall sync.txt")
print(f"sync overall     {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}connect sync.txt")
print(f"sync connect     {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SnowflakeRestful.fetch.txt")
print(f"sync fetch       {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SFOCSP.validate_async.txt")
print(f"sync OCSP        {mean(f):.5f}, {len(f)}")
print("~~~~~~~~~~~~~~~~")
f = read_file_to_float_list(f"{prefix}overall async.txt")
print(f"async overall    {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}connect async.txt")
print(f"async connect    {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SnowflakeRestfulAsync.fetch.txt")
print(f"async fetch      {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SFOCSP.validate.txt")
print(f"async OCSP       {mean(f):.5f}, {len(f)}")
print("~~~~~~~~~~~~~~~~")
print()

prefix = "/tmp/aiohttp_test/connect without OCSP cache (500 calls)/"
print(prefix)
print("~~~~~~~~~~~~~~~~")
f = read_file_to_float_list(f"{prefix}overall sync.txt")
print(f"sync overall     {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}connect sync.txt")
print(f"sync connect     {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SnowflakeRestful.fetch.txt")
print(f"sync fetch       {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SFOCSP.validate.txt")
print(f"sync OCSP        {mean(f):.5f}, {len(f)}")
print("~~~~~~~~~~~~~~~~")
f = read_file_to_float_list(f"{prefix}overall async.txt")
print(f"async overall    {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}connect async.txt")
print(f"async connect    {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SnowflakeRestfulAsync.fetch.txt")
print(f"async fetch      {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SFOCSP.validate_async.txt")
print(f"async OCSP       {mean(f):.5f}, {len(f)}")
print("~~~~~~~~~~~~~~~~")
print()

prefix = "/tmp/aiohttp_test/execute trivial SELECT (500 calls)/"
print(prefix)
print("~~~~~~~~~~~~~~~~")
f = read_file_to_float_list(f"{prefix}overall sync.txt")
print(f"sync overall     {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}execute sync.txt")
print(f"sync execute     {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SnowflakeRestful.fetch.txt")
print(f"sync fetch       {mean(f):.5f}, {len(f)}")
print("~~~~~~~~~~~~~~~~")
f = read_file_to_float_list(f"{prefix}overall async.txt")
print(f"async overall    {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}execute async.txt")
print(f"async execute    {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SnowflakeRestfulAsync.fetch.txt")
print(f"async fetch      {mean(f):.5f}, {len(f)}")
print("~~~~~~~~~~~~~~~~")
print()

prefix = "/tmp/aiohttp_test/execute 100k SELECT (200 calls)/"
print(prefix)
print("~~~~~~~~~~~~~~~~")
f = read_file_to_float_list(f"{prefix}overall sync.txt")
print(f"sync overall     {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}execute sync.txt")
print(f"sync execute     {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}ResultBatch._download.txt")
print(f"sync download    {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SnowflakeRestful.fetch.txt")
print(f"sync fetch       {mean(f):.5f}, {len(f)}")
print("~~~~~~~~~~~~~~~~")
f = read_file_to_float_list(f"{prefix}overall async.txt")
print(f"async overall    {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}execute async.txt")
print(f"async execute    {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}ResultBatchAsync._download_async.txt")
print(f"async download   {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SnowflakeRestfulAsync.fetch.txt")
print(f"async fetch      {mean(f):.5f}, {len(f)}")
print("~~~~~~~~~~~~~~~~")
print()

prefix = "/tmp/aiohttp_test/execute 1m SELECT (100 calls)/"
print(prefix)
print("~~~~~~~~~~~~~~~~")
f = read_file_to_float_list(f"{prefix}overall sync.txt")
print(f"sync overall     {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}execute sync.txt")
print(f"sync execute     {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}ResultBatch._download.txt")
print(f"sync download    {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SnowflakeRestful.fetch.txt")
print(f"sync fetch       {mean(f):.5f}, {len(f)}")
print("~~~~~~~~~~~~~~~~")
f = read_file_to_float_list(f"{prefix}overall async.txt")
print(f"async overall    {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}execute async.txt")
print(f"async execute    {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}ResultBatchAsync._download_async.txt")
print(f"async download   {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SnowflakeRestfulAsync.fetch.txt")
print(f"async fetch      {mean(f):.5f}, {len(f)}")
print("~~~~~~~~~~~~~~~~")
print()

prefix = "/tmp/aiohttp_test/execute 190mb GET (50 calls)/"
print(prefix)
print("~~~~~~~~~~~~~~~~")
f = read_file_to_float_list(f"{prefix}overall sync.txt")
print(f"sync overall     {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}execute sync.txt")
print(f"sync execute     {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SnowflakeFileTransferAgent.execute.txt")
print(f"sync ft execute  {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(
    f"{prefix}SnowflakeStorageClient._send_request_with_retry.txt"
)
print(f"sync ft request  {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SnowflakeRestful.fetch.txt")
print(f"sync fetch       {mean(f):.5f}, {len(f)}")
print("~~~~~~~~~~~~~~~~")
f = read_file_to_float_list(f"{prefix}overall async.txt")
print(f"async overall    {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}execute async.txt")
print(f"async execute    {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SnowflakeFileTransferAgentAsync.execute.txt")
print(f"async ft execute {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(
    f"{prefix}SnowflakeStorageClientAsync._send_request_with_retry_async.txt"
)
print(f"async ft request {mean(f):.5f}, {len(f)}")
f = read_file_to_float_list(f"{prefix}SnowflakeRestfulAsync.fetch.txt")
print(f"async fetch      {mean(f):.5f}, {len(f)}")
print("~~~~~~~~~~~~~~~~")
print()
